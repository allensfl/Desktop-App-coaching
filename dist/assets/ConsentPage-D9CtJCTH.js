import{z as $,A as G,i as M,d as q,r,j as e,E as b,e as S,f as P,g as E,h as I,H as J,m as K,ac as Q,B as F}from"./index-BCVF1PLb.js";import{P as X}from"./PrivacyPolicyContent-DWtEFWzt.js";import{E as Y}from"./jspdf.es.min-BgNKXESA.js";import _ from"./html2canvas.esm-CBrSDip1.js";import{S as ee}from"./shield-B3eKfCJ1.js";import{C as L}from"./check-circle-DyRGt_RB.js";import{D as te}from"./download-DKg7zGZ5.js";const oe=()=>{const{coacheeId:f}=$();G();const{toast:i}=M(),{state:d,actions:z}=q(),{settings:x}=d,{getCoacheeById:N,updateCoacheeConsent:R}=z,[h,B]=r.useState(null),[y,C]=r.useState(!1),[H,U]=r.useState(!0),v=r.useRef(null),[l,c]=r.useState(!1);r.useEffect(()=>{if(d.isLoading)return;const t=N(f);t&&(B(t),C(t.consents.gdpr)),U(!1)},[f,N,d.isLoading,d.coachees]);const D=async()=>{const t=v.current;if(!t)return null;const o=t.style.color;t.style.color="black";const s=t.querySelectorAll(".hide-on-pdf");s.forEach(n=>n.style.display="none");try{const n=await _(t,{scale:2,backgroundColor:"#ffffff",useCORS:!0});t.style.color=o,s.forEach(Z=>Z.style.display="");const m=n.toDataURL("image/png"),a=new Y("p","mm","a4"),j=a.internal.pageSize.getWidth(),O=n.width,T=n.height,W=O/T;let u=j/W,g=u,w=0;for(a.addImage(m,"PNG",0,w,j,u),g-=a.internal.pageSize.getHeight();g>=0;)w=g-u,a.addPage(),a.addImage(m,"PNG",0,w,j,u),g-=a.internal.pageSize.getHeight();return a.output("blob")}catch(n){return console.error("PDF generation failed:",n),t.style.color=o,s.forEach(m=>m.style.display=""),null}},V=async()=>{c(!0),i({title:"PDF wird generiert...",description:"Bitte warten Sie einen Moment."});const t=await D();if(t){const o=URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download=`datenschutzerklaerung-${h.lastName}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o),i({title:"✅ Download erfolgreich!",description:"Die PDF-Datei wurde heruntergeladen."})}else i({variant:"destructive",title:"Fehler beim Download",description:"Die PDF konnte nicht erstellt werden."});c(!1)},A=async()=>{c(!0),i({title:"Verarbeite Zustimmung...",description:"Moment bitte..."});const t=await D();if(!t){i({variant:"destructive",title:"Fehler",description:"Einwilligung konnte nicht verarbeitet werden. Bitte versuchen Sie es erneut."}),c(!1);return}R(f,"gdpr",!0,t),C(!0),c(!1),i({title:"Vielen Dank für Ihre Zustimmung!",description:"Ihre Einwilligung wurde erfolgreich gespeichert und archiviert.",className:"bg-green-600 text-white border-green-700"})};if(H)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-950 text-white p-4",children:e.jsx(b,{className:"h-8 w-8 animate-spin"})});if(!h)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-950 text-white p-4",children:e.jsxs(S,{className:"w-full max-w-lg glass-card text-center",children:[e.jsx(P,{children:e.jsx(E,{children:"Ungültiger Link"})}),e.jsx(I,{children:e.jsx("p",{className:"text-slate-300",children:"Der von Ihnen aufgerufene Link ist ungültig oder abgelaufen. Bitte kontaktieren Sie Ihren Coach."})})]})});const p=`${h.firstName} ${h.lastName}`,k=x.company.name||"Ihrem Coach";return e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsxs("title",{children:["Einwilligung zur Datenverarbeitung - ",p]}),e.jsx("meta",{name:"description",content:"Bitte erteilen Sie Ihre Einwilligung zur Verarbeitung Ihrer Daten im Rahmen des Coachings."})]}),e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-950 text-white p-4",children:e.jsx(K.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"w-full max-w-4xl",children:e.jsxs(S,{className:"glass-card",children:[e.jsxs(P,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:x.company.logoUrl?e.jsx("img",{src:x.company.logoUrl,alt:"Firmenlogo",className:"h-16 w-auto"}):e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx(ee,{className:"w-8 h-8 text-white"})})}),e.jsx(E,{className:"text-2xl font-bold",children:"Einwilligung & Datenschutzerklärung"}),e.jsxs("p",{className:"text-slate-400",children:["Für das Coaching mit ",k]})]}),e.jsx(I,{className:"space-y-6 text-slate-300",children:y?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"mx-auto h-16 w-16 text-green-400 mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Vielen Dank!"}),e.jsx("p",{children:"Ihre Einwilligung wurde bereits erteilt und ist gespeichert."}),e.jsx("p",{children:"Sie können dieses Fenster nun schließen."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Sehr geehrte/r ",e.jsx("span",{className:"font-bold text-white",children:p}),","]}),e.jsx("p",{children:"bitte lesen Sie die nachfolgende Datenschutzerklärung sorgfältig durch und erteilen Sie anschließend Ihre Zustimmung zur Verarbeitung Ihrer Daten."}),e.jsx("div",{className:"mt-6 p-6 bg-slate-900/70 rounded-lg max-h-96 overflow-y-auto border border-slate-700",children:e.jsx("div",{ref:v,children:e.jsx(X,{coacheeName:p,coachName:k})})}),e.jsx("p",{className:"pt-4",children:"Sie können diese Einwilligung jederzeit widerrufen."})]})}),!y&&e.jsxs(Q,{className:"flex flex-col md:flex-row items-center justify-center gap-4",children:[e.jsxs(F,{onClick:V,variant:"outline",className:"w-full md:w-auto",disabled:l,children:[l?e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(te,{className:"mr-2 h-4 w-4"}),"Als PDF herunterladen"]}),e.jsxs(F,{onClick:A,className:"w-full md:w-auto bg-green-600 hover:bg-green-700",disabled:l,children:[l?e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(L,{className:"mr-2 h-4 w-4"}),l?"Verarbeite...":"Ich stimme zu und habe die Erklärung gelesen"]})]})]})})})]})};export{oe as default};
