import{r as C,j as e,D as oe,G as de,B as g,k as me,n as he,o as ue,p as xe,I as h,s as pe,t as ge,J as c,A as ae,m as je,C as te,F as fe,U as Q,e as _,f as ve,g as Ne,h as H,d as we,i as be,H as Ce,K as Se}from"./index-BCVF1PLb.js";import{T as De,a as ye,b as J,c as W}from"./tabs-D-qa9ZUa.js";import{c as Ie}from"./index-DQa-zP0n.js";import{F as Ee}from"./FileSaver.min-C6hR5fcS.js";import{I as P}from"./input-CMYn3E83.js";import{L as b}from"./label-gCXM_mwv.js";import{T as Te}from"./textarea-Ei5qcXJt.js";import{S as F,a as L,b as O,c as R,d as f}from"./select-B5ckg96L.js";import{B as Z}from"./badge-EtFkFwpi.js";import{U as ke}from"./user-CaCbtgVu.js";import{C as Ae}from"./clock-BzT5nvLL.js";import{P as Pe}from"./package-BsT2hppd.js";import{C as Fe,A as Le,P as Oe,M as Re,L as $e,a as Me}from"./phone-prHRcx9J.js";import{P as Ve}from"./play-CadWJtWA.js";import{A as ze}from"./archive-GCBZU5bP.js";import{V as _e}from"./video-QN8leYHV.js";import{C as He}from"./calendar-CpAfWw-a.js";import{d as Ue}from"./de-B2K29ify.js";import"./index-CTsaMBSn.js";import"./floating-ui.react-dom-DMRTrF13.js";import"./check-C26bXOMj.js";import"./isSameYear-DGw-2Tmo.js";import"./chevron-right-CVrpxHPZ.js";import"./chevron-left-B6OT_W-B.js";const Be=({open:a,onOpenChange:v,onSubmit:d,coachees:x,activePackages:p})=>{const[u,o]=C.useState(""),r=(p||[]).filter(s=>s.coacheeId===parseInt(u)&&s.usedUnits<s.totalUnits),j=s=>{s.preventDefault();const w=new FormData(s.target),i=Object.fromEntries(w.entries()),E=x.find(I=>I.id===parseInt(i.coacheeId)),y=new Date(`${i.date}T${i.time}`),$={id:Date.now(),coacheeId:parseInt(i.coacheeId),coacheeName:`${E.firstName} ${E.lastName}`,date:y.toISOString(),duration:parseInt(i.duration),mode:i.mode,status:c.PLANNED,topic:i.topic,coachNotes:i.notes,packageId:i.packageId&&i.packageId!=="none"?parseInt(i.packageId):null,billed:!!(i.packageId&&i.packageId!=="none")};d($),o("")};return e.jsxs(oe,{open:a,onOpenChange:v,children:[e.jsx(de,{asChild:!0,children:e.jsxs(g,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Neue Session"]})}),e.jsxs(he,{className:"sm:max-w-[425px] glass-card",children:[e.jsx(ue,{children:e.jsx(xe,{children:"Neue Session planen"})}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"coacheeId",children:"Coachee"}),e.jsxs(F,{name:"coacheeId",required:!0,onValueChange:o,children:[e.jsx(L,{children:e.jsx(O,{placeholder:"Coachee auswählen"})}),e.jsx(R,{children:(x||[]).map(s=>e.jsxs(f,{value:String(s.id),children:[s.firstName," ",s.lastName]},s.id))})]})]}),u&&r.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"packageId",children:"Paket zuordnen (optional)"}),e.jsxs(F,{name:"packageId",defaultValue:"none",children:[e.jsx(L,{children:e.jsx(O,{placeholder:"Paket auswählen..."})}),e.jsxs(R,{children:[e.jsx(f,{value:"none",children:"Kein Paket"}),r.map(s=>e.jsxs(f,{value:String(s.id),children:[s.packageName," (",s.usedUnits,"/",s.totalUnits," verbraucht)"]},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"date",children:"Datum"}),e.jsx(P,{id:"date",name:"date",type:"date",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"time",children:"Uhrzeit"}),e.jsx(P,{id:"time",name:"time",type:"time",required:!0})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"duration",children:"Dauer (Minuten)"}),e.jsx(P,{id:"duration",name:"duration",type:"number",placeholder:"60",defaultValue:"60",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"mode",children:"Modus"}),e.jsxs(F,{name:"mode",defaultValue:h.REMOTE,required:!0,children:[e.jsx(L,{children:e.jsx(O,{placeholder:"Session-Modus auswählen"})}),e.jsxs(R,{children:[e.jsx(f,{value:h.IN_PERSON,children:"Vor Ort"}),e.jsx(f,{value:h.REMOTE,children:"Remote"}),e.jsx(f,{value:h.PHONE,children:"Telefon"}),e.jsx(f,{value:h.HYBRID,children:"Hybrid"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"topic",children:"Thema"}),e.jsx(P,{id:"topic",name:"topic",placeholder:"Session-Thema",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"notes",children:"Notizen (optional)"}),e.jsx(Te,{name:"notes",id:"notes",placeholder:"Vorbereitungsnotizen..."})]})]}),e.jsxs(pe,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(g,{type:"button",variant:"outline",children:"Abbrechen"})}),e.jsx(g,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",children:"Session erstellen"})]})]})]})]})},qe=a=>{switch(a){case h.IN_PERSON:return Re;case h.REMOTE:return _e;case h.PHONE:return Oe;case h.HYBRID:return Q;default:return Q}},Ke=a=>{switch(a){case h.IN_PERSON:return"Vor Ort";case h.REMOTE:return"Remote";case h.PHONE:return"Telefon";case h.HYBRID:return"Hybrid";default:return"Hybrid"}},X=a=>{switch(a){case c.PLANNED:return"status-pending";case c.COMPLETED:return"status-active";case c.CANCELED:return"bg-red-500/20 text-red-400 border-red-500/30";default:return"status-inactive"}},Ye=({session:a,index:v,onCardClick:d,onToggleArchive:x,onStatusChange:p,onCreateInvoice:u,activePackages:o,onAddToCalendar:r})=>{const j=ae(),s=qe(a.mode),w=a.packageId?(o||[]).find(i=>i.id===a.packageId):null;return e.jsx(je.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:v*.05},className:"border border-slate-700 rounded-lg p-4 hover:bg-slate-800/50 transition-colors group",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1 cursor-pointer",onClick:()=>d(a),children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 ${X(a.status)} bg-opacity-20`,children:e.jsx(te,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-white truncate group-hover:text-blue-400",children:a.topic}),e.jsxs("div",{className:"text-sm text-slate-400 mb-2 flex items-center flex-wrap gap-x-2",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(ke,{className:"inline h-3 w-3 mr-1"}),a.coacheeName]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ae,{className:"inline h-3 w-3 mr-1"}),new Date(a.date).toLocaleDateString("de-DE")]})]}),e.jsx("p",{className:"text-sm text-slate-300 line-clamp-1",children:a.coachNotes})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-end sm:items-center gap-2",children:[e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[w&&e.jsxs(Z,{variant:"outline",className:"text-xs border-amber-500/50 text-amber-400",children:[e.jsx(Pe,{className:"mr-1 h-3 w-3"})," ",w.packageName," (",w.usedUnits,"/",w.totalUnits,")"]}),e.jsxs(F,{value:a.status,onValueChange:i=>p(a.id,i),children:[e.jsx(L,{className:`w-[140px] text-xs h-7 ${X(a.status)}`,children:e.jsx(O,{})}),e.jsxs(R,{children:[e.jsx(f,{value:c.PLANNED,children:"Geplant"}),e.jsx(f,{value:c.COMPLETED,children:"Abgeschlossen"}),e.jsx(f,{value:c.CANCELED,children:"Abgesagt"})]})]}),e.jsxs(Z,{variant:"outline",className:"text-xs",children:[e.jsx(s,{className:"mr-1 h-3 w-3"}),Ke(a.mode)]})]}),e.jsxs("div",{className:"flex gap-2",children:[a.status===c.PLANNED&&e.jsx(g,{size:"icon",variant:"ghost",onClick:()=>r(a),title:"Zum Kalender hinzufügen",children:e.jsx(Fe,{className:"h-4 w-4"})}),a.status===c.PLANNED&&e.jsxs(g,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>j(`/coaching-room/${a.coacheeId}`),children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"})," Starten"]}),a.status===c.COMPLETED&&!a.billed&&!a.packageId&&e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>u(a),children:[e.jsx(fe,{className:"h-4 w-4 mr-2"})," Rechnung"]}),e.jsx(g,{size:"icon",variant:"ghost",onClick:()=>x(a.id),title:a.archived?"Wiederherstellen":"Archivieren",children:a.archived?e.jsx(Le,{className:"h-4 w-4"}):e.jsx(ze,{className:"h-4 w-4"})})]})]})]})},a.id)},ee=({sessions:a,onCardClick:v,onToggleArchive:d,onStatusChange:x,onCreateInvoice:p,activePackages:u,onAddToCalendar:o})=>e.jsxs(_,{className:"glass-card mt-6",children:[e.jsx(ve,{children:e.jsx(Ne,{className:"text-white",children:"Session-Liste"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[a.map((r,j)=>e.jsx(Ye,{session:r,index:j,onCardClick:v,onToggleArchive:d,onStatusChange:x,onCreateInvoice:p,activePackages:u,onAddToCalendar:o},r.id)),a.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"mx-auto h-12 w-12 text-slate-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Keine Sessions gefunden"}),e.jsx("p",{className:"text-slate-400",children:"Für diesen Filter gibt es keine Einträge."})]})]})})]}),Ge=({date:a,setDate:v,sessions:d,onDayClick:x})=>e.jsx(_,{className:"glass-card mt-6",children:e.jsx(H,{className:"p-2 sm:p-6",children:e.jsx(He,{mode:"single",selected:a,onSelect:v,className:"p-0",locale:Ue,classNames:{root:"w-full",months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4 w-full",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium text-white",nav:"space-x-1 flex items-center",nav_button:"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-slate-400 rounded-md w-full font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-24 w-full text-center text-sm p-1 relative [&:has([aria-selected])]:bg-slate-800/50 first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:"h-full w-full p-0 font-normal aria-selected:opacity-100",day_selected:"bg-blue-600 text-white hover:bg-blue-700 focus:bg-blue-600 rounded-md",day_today:"bg-slate-800 text-white rounded-md",day_outside:"text-slate-500 opacity-50",day_disabled:"text-slate-500 opacity-50",day_hidden:"invisible"},components:{DayContent:({date:p})=>{const u=d.filter(o=>new Date(o.date).toDateString()===p.toDateString());return e.jsxs("div",{className:"h-full w-full flex flex-col items-start p-1",children:[e.jsx("time",{dateTime:p.toISOString(),children:p.getDate()}),e.jsx("div",{className:"flex-grow w-full overflow-y-auto text-left mt-1",children:u.map(o=>e.jsx("div",{className:"text-xs p-1 rounded-sm bg-blue-900/50 mb-1 truncate",onClick:()=>x(o),children:o.topic},o.id))})]})}}})})}),va=()=>{const{state:a,actions:v}=we(),{sessions:d,coachees:x,invoices:p,activePackages:u,serviceRates:o,settings:r}=a,{setSessions:j,setInvoices:s,deductFromPackage:w}=v,[i,E]=C.useState(!1),[y,$]=C.useState("all"),[I,U]=C.useState("list"),[se,ie]=C.useState(new Date),{toast:T}=be(),B=ae(),le=t=>{j(l=>[...l,t].sort((m,n)=>new Date(n.date)-new Date(m.date))),T({title:"Session erstellt!",description:`Die Session mit ${t.coacheeName} wurde geplant.`,className:"bg-green-600 text-white"}),E(!1)},q=t=>{var k;const l=new Date(t.date),m=[l.getFullYear(),l.getMonth()+1,l.getDate(),l.getHours(),l.getMinutes()],n={minutes:t.duration},N={start:m,duration:n,title:`Coaching: ${t.topic}`,description:`Coaching Session mit ${t.coacheeName}. Notizen: ${t.coachNotes}`,organizer:{name:r.company.name,email:r.company.email},attendees:[{name:r.company.name,email:r.company.email,rsvp:!0,partstat:"ACCEPTED",role:"REQ-PARTICIPANT"},{name:t.coacheeName,email:((k=x.find(S=>S.id===t.coacheeId))==null?void 0:k.email)||"",rsvp:!0,partstat:"NEEDS-ACTION",role:"REQ-PARTICIPANT"}]};t.mode==="in-person"&&r.company.street&&(N.location=`${r.company.street}, ${r.company.zip} ${r.company.city}`),Ie(N,(S,A)=>{if(S){console.error(S),T({variant:"destructive",title:"Fehler",description:"Kalender-Datei konnte nicht erstellt werden."});return}const D=new Blob([A],{type:"text/calendar;charset=utf-8"});Ee.saveAs(D,`Coaching-${t.topic.replace(/ /g,"_")}.ics`),T({title:"Kalender-Datei erstellt",description:"Die .ics-Datei wurde heruntergeladen."})})},K=t=>{var N,k,S,A;const l=`CS-${new Date().getFullYear()}-${((p||[]).length+1).toString().padStart(3,"0")}`,m=o.find(D=>D.name.toLowerCase().includes("standard"))||{id:null,price:120},n={id:Date.now(),invoiceNumber:l,coacheeId:t.coacheeId,date:new Date().toISOString().split("T")[0],dueDate:new Date(Date.now()+14*24*60*60*1e3).toISOString().split("T")[0],status:Se.DRAFT,items:[{id:`session-${t.id}`,description:`Coaching-Session: "${t.topic}" vom ${new Date(t.date).toLocaleDateString("de-DE")}`,quantity:1,price:m.price,rateId:m.id,isCustom:!m.id,sessionId:t.id}],taxRate:((k=(N=a.settings)==null?void 0:N.company)==null?void 0:k.defaultTaxRate)||19,currency:((A=(S=a.settings)==null?void 0:S.company)==null?void 0:A.defaultCurrency)||"EUR"};s(D=>[...D||[],n]),j(D=>D.map(z=>z.id===t.id?{...z,billed:!0}:z)),T({title:"Rechnung erstellt",description:"Ein Rechnungsentwurf für die Session wurde erstellt.",action:e.jsx(g,{onClick:()=>B(`/invoices/edit/${n.id}`),children:"Bearbeiten"}),className:"bg-green-600 text-white"})},M=t=>{B(`/coaching-room/${t.coacheeId}?session_id=${t.id}`)},Y=t=>{const l=d.find(n=>n.id===t);if(!l)return;const m=!l.archived;j(n=>n.map(N=>N.id===t?{...N,archived:m}:N)),T({title:`Session ${m?"archiviert":"wiederhergestellt"}!`,description:`Die Session "${l.topic}" wurde ${m?"ins Archiv verschoben":"aus dem Archiv entfernt"}.`})},G=(t,l)=>{j(m=>m.map(n=>n.id===t?(l===c.COMPLETED&&n.status!==c.COMPLETED&&n.packageId&&w(n.packageId),{...n,status:l}):n))},V=C.useMemo(()=>(d||[]).filter(t=>!t.archived),[d]),ne=C.useMemo(()=>(d||[]).filter(t=>t.archived),[d]),re=C.useMemo(()=>V.filter(t=>y==="all"||t.status===y).sort((t,l)=>new Date(l.date)-new Date(t.date)),[V,y]),ce=[{value:"all",label:"Alle"},{value:c.PLANNED,label:"Geplant"},{value:c.COMPLETED,label:"Abgeschlossen"},{value:c.CANCELED,label:"Abgesagt"}];return e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{children:[e.jsx("title",{children:"Sessions - Coachingspace"}),e.jsx("meta",{name:"description",content:"Verwalte deine Coaching-Sessions, plane neue Termine und dokumentiere Fortschritte."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Sessions"}),e.jsx("p",{className:"text-slate-400",children:"Verwalte deine Coaching-Sessions"})]}),e.jsx(Be,{open:i,onOpenChange:E,onSubmit:le,coachees:x,activePackages:u})]}),e.jsxs(De,{defaultValue:"active",className:"w-full",children:[e.jsxs(ye,{className:"grid w-full grid-cols-2",children:[e.jsx(J,{value:"active",children:"Aktive Sessions"}),e.jsx(J,{value:"archive",children:"Archiv"})]}),e.jsxs(W,{value:"active",className:"mt-6",children:[e.jsx(_,{className:"glass-card",children:e.jsxs(H,{className:"p-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Filter:"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:ce.map(t=>e.jsx(g,{variant:y===t.value?"default":"outline",size:"sm",onClick:()=>$(t.value),children:t.label},t.value))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{variant:I==="list"?"default":"outline",size:"sm",onClick:()=>U("list"),children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Liste"]}),e.jsxs(g,{variant:I==="calendar"?"default":"outline",size:"sm",onClick:()=>U("calendar"),children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Kalender"]})]})]})}),I==="list"&&e.jsx(ee,{sessions:re,onCardClick:M,onToggleArchive:Y,onStatusChange:G,onCreateInvoice:K,activePackages:u,onAddToCalendar:q}),I==="calendar"&&e.jsx(Ge,{date:se,setDate:ie,sessions:V,onDayClick:M})]}),e.jsx(W,{value:"archive",className:"mt-6",children:e.jsx(ee,{sessions:ne,onCardClick:M,onToggleArchive:Y,onStatusChange:G,onCreateInvoice:K,activePackages:u,onAddToCalendar:q})})]})]})]})};export{va as default};
