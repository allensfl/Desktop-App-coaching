import{r as x,i as V,j as e,D as X,G as me,B as f,a6 as xe,n as Q,o as Y,p as ee,q as ue,s as se,h as E,ab as U,e as C,f as D,g as k,af as $,m as te,k as ae,T as le,v as re,w as pe,R as je,t as ge,y as ie,X as fe,ac as be,F as Ne,al as we,C as ve,z as ye,A as Se,d as Ce,E as De,H as ke,ah as Ee}from"./index-BCVF1PLb.js";import{A as B,a as ne,b as L,c as O,d as H,e as _,f as Z,g as ce,h as J}from"./alert-dialog-C4_CwsSl.js";import{I as G}from"./input-CMYn3E83.js";import{F as Te}from"./FileSaver.min-C6hR5fcS.js";import{K as Ae}from"./key-round-NqSuZ4IQ.js";import{S as Pe}from"./shield-check-BtYFX98R.js";import{E as ze,M as Ge}from"./message-square-CSPlkRDh.js";import{E as oe}from"./eye-B95wPRoU.js";import{D as Ie}from"./download-DKg7zGZ5.js";import{T as Fe,a as $e,b as P,c as z}from"./tabs-D-qa9ZUa.js";import{B as I}from"./badge-EtFkFwpi.js";import{C as Be}from"./check-circle-2-sdUbpfEf.js";import{C as Le}from"./circle-BXcq3N7T.js";import{C as Oe}from"./checkbox-CLqVbJq_.js";import{T as de}from"./textarea-Ei5qcXJt.js";import{T as He}from"./trophy-BWL3RJO3.js";import{T as F}from"./trash-2-Doau15tD.js";import{u as _e}from"./index-Btm19AAi.js";import{S as Ze}from"./save-BLsd0mx1.js";import{S as q}from"./share-2-lsO2aeSV.js";import{U as Je}from"./upload-cloud-Dj9vcIDN.js";import{f as We,d as Re}from"./de-B2K29ify.js";import{L as Me}from"./lock-DKnFagCm.js";import"./index-CTsaMBSn.js";import"./index-Cxa5liJK.js";import"./index-B8MATRhp.js";import"./check-C26bXOMj.js";const Ue=({coachee:s,updateCoacheeData:r,portalData:m})=>{var c,p;const[b,g]=x.useState(!1),[n,u]=x.useState(""),[N,i]=x.useState(""),[o,j]=x.useState(!1),{toast:l}=V(),a=async()=>{if(n!==N){l({title:"Fehler",description:"Die Passwörter stimmen nicht überein.",variant:"destructive"});return}if(n.length<8){l({title:"Fehler",description:"Das Passwort muss mindestens 8 Zeichen lang sein.",variant:"destructive"});return}const y=new TextEncoder().encode(n),T=await crypto.subtle.digest("SHA-256",y),t=Array.from(new Uint8Array(T)).map(h=>h.toString(16).padStart(2,"0")).join("");r({portalAccess:{...s.portalAccess,passwordHash:t}}),g(!1),u(""),i(""),l({title:"Passwort gesetzt!",description:"Dein Portal ist jetzt mit einem Passwort geschützt.",className:"bg-green-600 text-white"})},d=()=>{try{const v=JSON.stringify(m,null,2),y=new Blob([v],{type:"application/json;charset=utf-8"});Te.saveAs(y,`coachingspace_portal_backup_${s.firstName}_${new Date().toISOString().split("T")[0]}.json`),l({title:"Daten heruntergeladen"})}catch{l({title:"Fehler beim Download",variant:"destructive"})}};return e.jsxs("header",{className:"mb-8 text-center relative",children:[e.jsx("div",{className:"inline-block p-4 bg-primary/10 rounded-full mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-primary to-purple-600 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-bold text-3xl",children:[s.firstName[0],s.lastName[0]]})})}),e.jsxs("h1",{className:"text-4xl font-bold text-white",children:["Willkommen, ",s.firstName,"!"]}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Dein persönlicher und geschützter Raum für Reflexion und Wachstum."}),e.jsxs(X,{open:b,onOpenChange:g,children:[e.jsx(me,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"absolute top-0 right-0 text-slate-400 hover:text-white",children:e.jsx(xe,{})})}),e.jsxs(Q,{children:[e.jsxs(Y,{children:[e.jsx(ee,{children:"Portal-Einstellungen"}),e.jsx(ue,{children:"Hier kannst du dein Portal absichern und deine Daten verwalten."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Ae,{})," Passwortschutz"]}),(c=s.portalAccess)!=null&&c.passwordHash?e.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[e.jsx(Pe,{}),e.jsx("span",{children:"Dein Portal ist geschützt."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Sichere dein Portal mit einem Passwort."}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:o?"text":"password",placeholder:"Neues Passwort",value:n,onChange:v=>u(v.target.value)}),e.jsx(f,{variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8",onClick:()=>j(!o),children:o?e.jsx(ze,{}):e.jsx(oe,{})})]}),e.jsx(G,{type:o?"text":"password",placeholder:"Passwort bestätigen",value:N,onChange:v=>i(v.target.value)})]}),e.jsxs("h3",{className:"font-semibold flex items-center gap-2 pt-4",children:[e.jsx(Ie,{})," Daten-Backup"]}),e.jsx(f,{variant:"outline",className:"w-full",onClick:d,children:"Alle Portal-Daten herunterladen"})]}),e.jsx(se,{children:!((p=s.portalAccess)!=null&&p.passwordHash)&&e.jsx(f,{onClick:a,children:"Passwort speichern"})})]})]})]})},K=({task:s,onToggle:r})=>{const m={Niedrig:"bg-blue-500/20 text-blue-300 border-blue-500/30",Mittel:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30",Hoch:"bg-red-500/20 text-red-300 border-red-500/30"};return e.jsxs(te.div,{layout:!0,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:`flex items-center gap-4 p-3 rounded-lg transition-colors duration-200 ${s.completed?"bg-slate-800/30":"hover:bg-slate-800/50"}`,children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>r(s.id),className:"flex-shrink-0",children:s.completed?e.jsx(Be,{className:"h-6 w-6 text-green-500"}):e.jsx(Le,{className:"h-6 w-6 text-slate-500 group-hover:text-primary"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:`text-sm ${s.completed?"text-slate-500 line-through":"text-slate-200"}`,children:s.text}),s.dueDate&&e.jsxs("p",{className:"text-xs text-slate-400",children:["Fällig am: ",new Date(s.dueDate).toLocaleDateString("de-DE")]})]}),s.priority&&e.jsx(I,{className:`hidden sm:inline-flex ${m[s.priority]}`,children:s.priority})]})},he=({coachee:s,tasks:r,onUpdateTasks:m,isDashboardVersion:b=!1})=>{const g=(r||[]).filter(o=>o.coacheeId===s.id),n=g.filter(o=>!o.completed),u=g.filter(o=>o.completed),N=o=>{const j=(r||[]).map(l=>l.id===o?{...l,completed:!l.completed}:l);m(j)},i=e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-300 mb-3",children:"Offene Aufgaben"}),e.jsx("div",{className:"space-y-2",children:e.jsx(U,{children:n.length>0?n.map(o=>e.jsx(K,{task:o,onToggle:N},o.id)):e.jsx("p",{className:"text-slate-400 text-center py-4",children:"Super! Keine offenen Aufgaben."})})})]}),!b&&u.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-300 mb-3",children:"Erledigte Aufgaben"}),e.jsx("div",{className:"space-y-2",children:e.jsx(U,{children:u.map(o=>e.jsx(K,{task:o,onToggle:N},o.id))})})]})]});return b?e.jsxs(C,{className:"bg-slate-900/50 border border-slate-800",children:[e.jsx(D,{children:e.jsxs(k,{className:"flex items-center gap-3 text-white",children:[e.jsx($,{className:"text-primary"}),"Deine Aufgaben"]})}),i]}):e.jsx(te.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(C,{className:"glass-card",children:[e.jsx(D,{children:e.jsxs(k,{className:"flex items-center gap-3 text-white",children:[e.jsx($,{className:"text-primary"}),"Deine Aufgaben"]})}),i]})})},qe=({coachee:s,tasks:r,onUpdateTasks:m})=>{const b=s.weeklyImpulse||"Was war dein größter Erfolg in dieser Woche und was hast du daraus gelernt?";return e.jsxs("div",{className:"space-y-8",children:[e.jsxs(C,{className:"bg-slate-900/50 border border-slate-800",children:[e.jsx(D,{children:e.jsxs(k,{className:"flex items-center gap-2 text-primary",children:[e.jsx(Ge,{})," Wochenimpuls vom Coach"]})}),e.jsx(E,{children:e.jsxs("p",{className:"text-lg text-slate-300 italic",children:['"',b,'"']})})]}),e.jsx(he,{coachee:s,tasks:r,onUpdateTasks:m,isDashboardVersion:!0})]})},Ke=({goal:s,isOpen:r,onOpenChange:m,onSave:b,coacheeId:g})=>{const[n,u]=x.useState(s);if(je.useEffect(()=>{u(s)},[s]),!n)return null;const N=(a,d)=>{u(c=>({...c,[a]:d}))},i=(a,d)=>{const c=[...n.subGoals];c[a]={...c[a],title:d},u(p=>({...p,subGoals:c}))},o=()=>{u(a=>({...a,subGoals:[...a.subGoals,{id:`sg_${Date.now()}`,title:"",completed:!1}]}))},j=a=>{const d=n.subGoals.filter((c,p)=>p!==a);u(c=>({...c,subGoals:d}))},l=()=>{b(n),m(!1)};return e.jsx(X,{open:r,onOpenChange:m,children:e.jsxs(Q,{className:"sm:max-w-[425px] bg-slate-900 border-slate-800 text-white",children:[e.jsx(Y,{children:e.jsx(ee,{children:n.id.startsWith("new_")?"Neues Ziel hinzufügen":"Ziel bearbeiten"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx(G,{placeholder:"Titel des Ziels",value:n.title,onChange:a=>N("title",a.target.value),className:"text-white"}),e.jsx(de,{placeholder:"Beschreibung",value:n.description,onChange:a=>N("description",a.target.value),className:"text-white"}),e.jsx("h4",{className:"font-semibold text-sm pt-2",children:"Sub-Ziele"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:n.subGoals.map((a,d)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{placeholder:`Sub-Ziel ${d+1}`,value:a.title,onChange:c=>i(d,c.target.value),className:"flex-grow text-white"}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>j(d),children:e.jsx(F,{className:"h-4 w-4 text-red-500"})})]},d))}),e.jsxs(f,{variant:"outline",onClick:o,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"})," Sub-Ziel hinzufügen"]})]}),e.jsxs(se,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(f,{variant:"secondary",children:"Abbrechen"})}),e.jsx(f,{onClick:l,children:"Speichern"})]})]})})},Ve=({coachee:s,updateCoacheeData:r})=>{const[m,b]=x.useState(!1),[g,n]=x.useState(null),u=(l,a)=>{const d=s.goals.map(c=>c.id===l?{...c,subGoals:c.subGoals.map(p=>p.id===a?{...p,completed:!p.completed}:p)}:c);r({goals:d})},N=()=>{n({id:`new_${Date.now()}`,title:"",description:"",subGoals:[],status:"In Progress"}),b(!0)},i=l=>{n(l),b(!0)},o=l=>{const a=s.goals.filter(d=>d.id!==l);r({goals:a})},j=l=>{const a=s.goals||[];let d;if(l.id.startsWith("new_")){const c={...l,id:`g_${Date.now()}`};d=[...a,c]}else d=a.map(c=>c.id===l.id?l:c);r({goals:d})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-right",children:e.jsxs(f,{onClick:N,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Neues Ziel hinzufügen"]})}),(s.goals||[]).map(l=>e.jsxs(C,{className:"bg-slate-900/50 border border-slate-800",children:[e.jsxs(D,{children:[e.jsxs(k,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(le,{})," ",l.title]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.subGoals.every(a=>a.completed)&&e.jsxs(I,{className:"bg-green-500/20 text-green-300 border-green-500/30 hidden sm:flex items-center",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Erreicht!"]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>i(l),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsxs(B,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",children:e.jsx(F,{className:"h-4 w-4 text-red-500"})})}),e.jsxs(L,{children:[e.jsxs(O,{children:[e.jsx(H,{children:"Bist du sicher?"}),e.jsx(_,{children:"Diese Aktion kann nicht rückgängig gemacht werden. Das Ziel wird dauerhaft gelöscht."})]}),e.jsxs(Z,{children:[e.jsx(ce,{children:"Abbrechen"}),e.jsx(J,{onClick:()=>o(l.id),className:"bg-red-600 hover:bg-red-700",children:"Löschen"})]})]})]})]})]}),e.jsx(pe,{children:l.description})]}),e.jsx(E,{className:"space-y-3",children:e.jsx("div",{className:"space-y-2",children:l.subGoals.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-slate-800/50",children:[e.jsx(Oe,{id:`subgoal-${a.id}`,checked:a.completed,onCheckedChange:()=>u(l.id,a.id)}),e.jsx("label",{htmlFor:`subgoal-${a.id}`,className:`flex-1 text-sm ${a.completed?"line-through text-slate-500":"text-slate-300"}`,children:a.title})]},a.id))})})]},l.id)),g&&e.jsx(Ke,{goal:g,isOpen:m,onOpenChange:b,onSave:j,coacheeId:s.id})]})},Xe=({coachee:s,portalData:r,updatePortalData:m,onShareJournalEntry:b})=>{const[g,n]=x.useState(""),[u,N]=x.useState(""),[i,o]=x.useState(null),{toast:j}=V(),l=()=>{if(u.trim()===""||g.trim()===""){j({variant:"destructive",title:"Fehler",description:"Bitte gib einen Titel und Inhalt ein."});return}const t={id:i?i.id:`portal_${Date.now()}`,title:g,date:new Date().toISOString(),content:u,shared:i?i.shared:!1,isShared:i?i.isShared:!1,coacheeId:s.id};let h;i?(h=r.journalEntries.map(w=>w.id===i.id?t:w),j({title:"Journaleintrag aktualisiert"})):(h=[t,...r.journalEntries||[]],j({title:"Journaleintrag hinzugefügt"})),m({journalEntries:h}),n(""),N(""),o(null)},a=t=>{o(t),n(t.title),N(t.content)},d=()=>{o(null),n(""),N("")},c=t=>{m({journalEntries:r.journalEntries.filter(h=>h.id!==t)}),j({title:"Eintrag gelöscht"})},p=t=>{b(h=>(h||[]).find(S=>S.id===t.id)?(h||[]).map(S=>S.id===t.id?{...S,isShared:!0}:S):[{...t,isShared:!0},...h||[]]),m({journalEntries:r.journalEntries.map(h=>h.id===t.id?{...h,shared:!0}:h)}),j({title:"Eintrag geteilt!",description:"Dein Coach kann diesen Eintrag jetzt sehen."})},v=x.useCallback(t=>{const h=t.map(w=>({id:Date.now()+Math.random(),name:w.name,size:`${(w.size/1024).toFixed(2)} KB`,uploadDate:new Date().toISOString(),shared:!1}));m({documents:[...h,...r.documents]}),j({title:"Upload erfolgreich",description:`${h.length} Datei(en) hochgeladen.`})},[m,r.documents,j]),{getRootProps:y,getInputProps:T,isDragActive:A}=_e({onDrop:v});return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(C,{className:"bg-slate-900/50 border border-slate-800 flex flex-col",children:[e.jsx(D,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ie,{})," Dein privates Journal"]})}),e.jsxs(E,{className:"space-y-4 flex-grow",children:[e.jsx(G,{value:g,onChange:t=>n(t.target.value),placeholder:"Titel des Eintrags",className:"bg-slate-800/50 border-slate-700"}),e.jsx(de,{value:u,onChange:t=>N(t.target.value),placeholder:"Was beschäftigt dich heute?",className:"min-h-[120px] bg-slate-800/50 border-slate-700"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:l,className:"w-full sm:w-auto",children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"})," ",i?"Änderung speichern":"Eintrag speichern"]}),i&&e.jsxs(f,{onClick:d,variant:"outline",children:[e.jsx(fe,{className:"mr-2 h-4 w-4"})," Abbrechen"]})]})]}),e.jsx(be,{className:"flex-col items-start space-y-4 pt-4 max-h-[50vh] overflow-y-auto pr-2",children:(r.journalEntries||[]).map(t=>e.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-lg w-full",children:[e.jsx("p",{className:"font-bold text-white",children:t.title}),e.jsx("p",{className:"text-sm text-slate-400 mb-2",children:We(new Date(t.date),"dd.MM.yyyy HH:mm",{locale:Re})}),e.jsx("p",{className:"text-slate-300 whitespace-pre-wrap",children:t.content}),e.jsxs("div",{className:"flex justify-between items-center mt-3 text-xs text-slate-500",children:[t.shared?e.jsxs(I,{variant:"outline",className:"text-green-400 border-green-500/50",children:[e.jsx(oe,{className:"mr-2 h-3 w-3"})," Für Coach sichtbar"]}):e.jsxs(f,{size:"sm",variant:"ghost",onClick:()=>p(t),children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," Freigeben"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(f,{size:"icon",variant:"ghost",onClick:()=>a(t),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsxs(B,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(f,{size:"icon",variant:"ghost",className:"text-red-500 hover:text-red-400",children:e.jsx(F,{className:"h-4 w-4"})})}),e.jsxs(L,{children:[e.jsxs(O,{children:[e.jsx(H,{children:"Sicher?"}),e.jsx(_,{children:"Möchtest du diesen Eintrag wirklich löschen?"})]}),e.jsxs(Z,{children:[e.jsx(ce,{children:"Abbrechen"}),e.jsx(J,{onClick:()=>c(t.id),className:"bg-red-600",children:"Löschen"})]})]})]})]})]})]},t.id))})]}),e.jsxs(C,{className:"bg-slate-900/50 border border-slate-800",children:[e.jsx(D,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Je,{})," Dokumente hochladen & teilen"]})}),e.jsxs(E,{children:[e.jsxs("div",{...y(),className:`p-6 border-2 border-dashed rounded-lg text-center cursor-pointer transition-colors ${A?"border-primary bg-primary/10":"border-slate-700 hover:border-slate-600"}`,children:[e.jsx("input",{...T()}),e.jsx("p",{children:"Dateien hierher ziehen oder klicken."})]}),e.jsx("div",{className:"space-y-3 mt-4 max-h-96 overflow-y-auto pr-2",children:r.documents.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"h-5 w-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-300",children:t.name}),e.jsx("p",{className:"text-xs text-slate-500",children:t.size})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.shared?e.jsx(I,{variant:"outline",className:"text-green-400 border-green-500/50",children:"Sichtbar"}):e.jsxs(f,{size:"sm",variant:"ghost",onClick:()=>p("documents",t.id),children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," Freigeben"]}),e.jsx(f,{size:"icon",variant:"ghost",className:"text-slate-500 hover:text-red-400",children:e.jsx(F,{className:"h-4 w-4"})})]})]},t.id))})]})]})]})},Qe=({coachee:s})=>e.jsx("div",{className:"space-y-4",children:e.jsxs(C,{className:"bg-slate-900/50 border border-slate-800",children:[e.jsx(D,{children:e.jsx(k,{children:"Vergangene & Zukünftige Sessions"})}),e.jsx(E,{children:e.jsx("ul",{className:"space-y-2",children:(s.sessions||[]).map(r=>e.jsxs("li",{className:"flex justify-between items-center p-3 bg-slate-800/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-200",children:r.topic}),e.jsx("p",{className:"text-sm text-slate-400",children:new Date(r.date).toLocaleString("de-DE",{dateStyle:"full",timeStyle:"short"})})]}),e.jsx(I,{variant:r.status==="Abgeschlossen"?"success":"outline",children:r.status})]},r.id))})})]})}),Ye=({coachee:s,portalData:r,updatePortalData:m,updateCoacheeData:b,tasks:g,onUpdateTasks:n,onShareJournalEntry:u})=>e.jsxs(Fe,{defaultValue:"dashboard",className:"w-full mt-8",children:[e.jsxs($e,{className:"grid w-full grid-cols-2 sm:grid-cols-3 md:grid-cols-5",children:[e.jsxs(P,{value:"dashboard",children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Dashboard"]}),e.jsxs(P,{value:"tasks",children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Aufgaben"]}),e.jsxs(P,{value:"goals",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Ziele"]}),e.jsxs(P,{value:"journal",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Journal & Docs"]}),e.jsxs(P,{value:"sessions",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Sessions"]})]}),e.jsx(z,{value:"dashboard",className:"mt-6",children:e.jsx(qe,{coachee:s,tasks:g||[],onUpdateTasks:n})}),e.jsx(z,{value:"tasks",className:"mt-6",children:e.jsx(he,{coachee:s,tasks:g||[],onUpdateTasks:n})}),e.jsx(z,{value:"goals",className:"mt-6",children:e.jsx(Ve,{coachee:s,updateCoacheeData:b})}),e.jsx(z,{value:"journal",className:"mt-6",children:e.jsx(Xe,{coachee:s,portalData:r,updatePortalData:m,onShareJournalEntry:u})}),e.jsx(z,{value:"sessions",className:"mt-6",children:e.jsx(Qe,{coachee:s})})]}),es=()=>e.jsxs("footer",{className:"text-center text-slate-600 text-sm mt-12 space-y-2",children:[e.jsxs("p",{className:"flex items-center justify-center gap-2 pt-4",children:[e.jsx(Me,{className:"h-4 w-4"})," Dieser Bereich ist Ende-zu-Ende-privat. Dein Coach sieht nur, was du explizit teilst."]}),e.jsx("p",{children:"Coaching Portal powered by Coachingspace."})]}),Es=()=>{const{token:s}=ye(),r=Se(),{state:m,actions:b}=Ce(),{getCoacheeByToken:g,updateCoachee:n,setTasks:u,setJournalEntries:N}=b,[i,o]=x.useState(null),[j,l]=x.useState({journalEntries:[],documents:[]}),[a,d]=x.useState(!1),[c,p]=x.useState(!0),[v,y]=x.useState(!1);x.useEffect(()=>{const t=()=>{var S,W;if(!s){y(!1),p(!1);return}const w=g(s);if(w)if(y(!0),((S=w.portalAccess)==null?void 0:S.initialToken)===s){const R=window.crypto.randomUUID(),M={...w,portalAccess:{...w.portalAccess,initialToken:null,permanentToken:R},auditLog:[...w.auditLog||[],{timestamp:new Date().toISOString(),user:"System",action:"Portal-Zugang aktiviert"}]};n(M),o(M),d(!0),window.history.replaceState(null,"",`/portal/${R}`),p(!1)}else((W=w.portalAccess)==null?void 0:W.permanentToken)===s?(o(w),p(!1)):(y(!1),p(!1));else y(!1),p(!1)};p(!0);const h=setTimeout(t,100);return()=>clearTimeout(h)},[s,g,n,m.isLoading]),x.useEffect(()=>{!c&&!v&&r("/invalid-link",{replace:!0})},[c,v,r]),x.useEffect(()=>{if(i)try{const t=localStorage.getItem(`coacheePortalData_${i.id}`);t&&l(JSON.parse(t))}catch(t){console.error("Failed to parse portal data from localStorage",t)}},[i]),x.useEffect(()=>{i&&!c&&localStorage.setItem(`coacheePortalData_${i.id}`,JSON.stringify(j))},[j,i,c]);const T=x.useCallback(t=>{l(h=>({...h,...t}))},[]),A=x.useCallback(t=>{const h={...i,...t};n(h),o(h)},[i,n]);return c||!i?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-slate-950 text-white p-4",children:[e.jsx(De,{className:"h-12 w-12 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-lg text-slate-400",children:"Öffne sicheren Coaching Raum..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx("title",{children:"Dein persönlicher Coaching Raum"}),e.jsx("meta",{name:"description",content:`Willkommen in deinem geschützten Bereich, ${i.firstName}.`})]}),e.jsx(B,{open:a,onOpenChange:d,children:e.jsxs(L,{children:[e.jsxs(O,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"text-yellow-400"})," Wichtiger Sicherheitshinweis!"]}),e.jsxs(_,{children:["Dies ist Ihr neuer, permanenter und geheimer Link zu Ihrem Portal.",e.jsx("strong",{className:"text-yellow-300",children:"Bitte speichern Sie diese Seite jetzt als Lesezeichen in Ihrem Browser."}),e.jsx("br",{}),e.jsx("br",{}),"Aus Sicherheitsgründen kann dieser Link von niemandem wiederhergestellt werden – auch nicht von Ihrem Coach."]})]}),e.jsx(Z,{children:e.jsx(J,{onClick:()=>d(!1),children:"Ich habe es verstanden und die Seite gespeichert"})})]})}),e.jsx("div",{className:"min-h-screen bg-slate-950 text-white p-4 sm:p-6 lg:p-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx(Ue,{coachee:i,updateCoacheeData:A,portalData:j}),e.jsx(Ye,{coachee:i,portalData:j,updatePortalData:T,updateCoacheeData:A,tasks:m.tasks,onUpdateTasks:u,onShareJournalEntry:N}),e.jsx(es,{})]})})]})};export{Es as default};
