import{r as h,j as e,D as H,n as R,o as B,p as Z,s as P,t as V,B as w,k as U,C as ae,e as $,f as be,U as ne,g as Se,h as L,ac as ke,v as ye,d as Te,i as Ee,H as Ie,a6 as Me,S as Oe,m as Je,y as Ae}from"./index-BCVF1PLb.js";import{I}from"./input-CMYn3E83.js";import{S as z,a as W,b as Y,c as K,d as v}from"./select-B5ckg96L.js";import{L as T}from"./label-gCXM_mwv.js";import{T as Fe}from"./textarea-Ei5qcXJt.js";import{P as Ue}from"./palette-BCUcZNiS.js";import{T as re}from"./trash-2-Doau15tD.js";import{S as $e}from"./save-BLsd0mx1.js";import{B as J}from"./badge-EtFkFwpi.js";import{a as se,m as ie,b as le,f as ce,d as oe}from"./de-B2K29ify.js";import{U as de}from"./user-CaCbtgVu.js";import{A as Le,a as ze,b as We,c as Ye,d as Ke,e as He,f as Re,g as Be,h as Ze}from"./alert-dialog-C4_CwsSl.js";import{c as _,i as Pe}from"./isToday-DmJ7ZUUg.js";import{i as Ve,a as _e}from"./isSameYear-DGw-2Tmo.js";import{F as Ge}from"./filter-O5up8hUD.js";import"./floating-ui.react-dom-DMRTrF13.js";import"./check-C26bXOMj.js";function qe(t,s,a){const n=se(t,a),i=se(s,a);return+n==+i}function Qe(t){return Ve(t,_(t))}function Xe(t,s){return qe(t,_(t),s)}function et(t){return _e(t,_(t))}function G(t,s){const n=nt(t);let i;if(n.date){const m=rt(n.date,2);i=it(m.restDateString,m.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);const r=i.getTime();let c=0,o;if(n.time&&(c=lt(n.time),isNaN(c)))return new Date(NaN);if(n.timezone){if(o=ct(n.timezone),isNaN(o))return new Date(NaN)}else{const m=new Date(r+c),p=new Date(0);return p.setFullYear(m.getUTCFullYear(),m.getUTCMonth(),m.getUTCDate()),p.setHours(m.getUTCHours(),m.getUTCMinutes(),m.getUTCSeconds(),m.getUTCMilliseconds()),p}return new Date(r+c+o)}const O={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},tt=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,st=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,at=/^([+-])(\d{2})(?::?(\d{2}))?$/;function nt(t){const s={},a=t.split(O.dateTimeDelimiter);let n;if(a.length>2)return s;if(/:/.test(a[0])?n=a[0]:(s.date=a[0],n=a[1],O.timeZoneDelimiter.test(s.date)&&(s.date=t.split(O.timeZoneDelimiter)[0],n=t.substr(s.date.length,t.length))),n){const i=O.timezone.exec(n);i?(s.time=n.replace(i[1],""),s.timezone=i[1]):s.time=n}return s}function rt(t,s){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),n=t.match(a);if(!n)return{year:NaN,restDateString:""};const i=n[1]?parseInt(n[1]):null,r=n[2]?parseInt(n[2]):null;return{year:r===null?i:r*100,restDateString:t.slice((n[1]||n[2]).length)}}function it(t,s){if(s===null)return new Date(NaN);const a=t.match(tt);if(!a)return new Date(NaN);const n=!!a[4],i=E(a[1]),r=E(a[2])-1,c=E(a[3]),o=E(a[4]),m=E(a[5])-1;if(n)return ut(s,o,m)?ot(s,o,m):new Date(NaN);{const p=new Date(0);return!ht(s,r,c)||!mt(s,i)?new Date(NaN):(p.setUTCFullYear(s,r,Math.max(i,c)),p)}}function E(t){return t?parseInt(t):1}function lt(t){const s=t.match(st);if(!s)return NaN;const a=F(s[1]),n=F(s[2]),i=F(s[3]);return xt(a,n,i)?a*ie+n*le+i*1e3:NaN}function F(t){return t&&parseFloat(t.replace(",","."))||0}function ct(t){if(t==="Z")return 0;const s=t.match(at);if(!s)return 0;const a=s[1]==="+"?-1:1,n=parseInt(s[2]),i=s[3]&&parseInt(s[3])||0;return gt(n,i)?a*(n*ie+i*le):NaN}function ot(t,s,a){const n=new Date(0);n.setUTCFullYear(t,0,4);const i=n.getUTCDay()||7,r=(s-1)*7+a+1-i;return n.setUTCDate(n.getUTCDate()+r),n}const dt=[31,null,31,30,31,30,31,31,30,31,30,31];function he(t){return t%400===0||t%4===0&&t%100!==0}function ht(t,s,a){return s>=0&&s<=11&&a>=1&&a<=(dt[s]||(he(t)?29:28))}function mt(t,s){return s>=1&&s<=(he(t)?366:365)}function ut(t,s,a){return s>=1&&s<=53&&a>=0&&a<=6}function xt(t,s,a){return t===24?s===0&&a===0:a>=0&&a<60&&s>=0&&s<60&&t>=0&&t<25}function gt(t,s){return s>=0&&s<=59}const pt=({open:t,onOpenChange:s,onSave:a,coachees:n,categories:i,initialEntry:r})=>{const[c,o]=h.useState(""),[m,p]=h.useState(""),[b,d]=h.useState(""),[f,N]=h.useState(""),[g,S]=h.useState("unassigned");h.useEffect(()=>{t&&(r?(o(r.title),p(r.date),d(r.categoryId||""),N(r.content),S(r.coacheeId?String(r.coacheeId):"unassigned")):(o(""),p(new Date().toISOString().split("T")[0]),d(""),N(""),S("unassigned")))},[r,t]);const C=()=>{const x={id:(r==null?void 0:r.id)||`coach_${Date.now()}`,title:c,date:m,categoryId:b,content:f,coacheeId:g==="unassigned"?null:parseInt(g),isShared:!1};a(x),s(!1)};return e.jsx(H,{open:t,onOpenChange:s,children:e.jsxs(R,{className:"sm:max-w-[600px] glass-card",children:[e.jsx(B,{children:e.jsx(Z,{children:r?"Journal-Eintrag bearbeiten":"Neuer Journal-Eintrag"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(T,{htmlFor:"title",children:"Titel"}),e.jsx(I,{id:"title",value:c,onChange:x=>o(x.target.value),placeholder:"Titel des Eintrags"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(T,{htmlFor:"date",children:"Datum"}),e.jsx(I,{id:"date",type:"date",value:m,onChange:x=>p(x.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(T,{htmlFor:"category",children:"Kategorie"}),e.jsxs(z,{value:b,onValueChange:d,children:[e.jsx(W,{children:e.jsx(Y,{placeholder:"Kategorie wählen"})}),e.jsx(K,{children:(i||[]).map(x=>e.jsx(v,{value:x.id,children:x.name},x.id))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(T,{htmlFor:"coachee",children:"Coachee (optional)"}),e.jsxs(z,{value:g,onValueChange:S,children:[e.jsx(W,{children:e.jsx(Y,{placeholder:"Coachee zuordnen"})}),e.jsxs(K,{children:[e.jsx(v,{value:"unassigned",children:"Kein Coachee"}),(n||[]).map(x=>e.jsxs(v,{value:String(x.id),children:[x.firstName," ",x.lastName]},x.id))]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(T,{htmlFor:"content",children:"Inhalt"}),e.jsx(Fe,{id:"content",value:f,onChange:x=>N(x.target.value),placeholder:"Schreibe deine Gedanken...",className:"min-h-[150px]"})]})]}),e.jsxs(P,{children:[e.jsx(V,{asChild:!0,children:e.jsx(w,{variant:"outline",children:"Abbrechen"})}),e.jsx(w,{onClick:C,children:r?"Änderungen speichern":"Eintrag speichern"})]})]})})},ft=({open:t,onOpenChange:s,categories:a,updateCategories:n})=>{const[i,r]=h.useState([]);h.useEffect(()=>{t&&r(a||[])},[a,t]);const c=(d,f)=>{r(N=>N.map(g=>g.id===d?{...g,name:f}:g))},o=(d,f)=>{r(N=>N.map(g=>g.id===d?{...g,color:f}:g))},m=()=>{const d={id:`new_${Date.now()}`,name:"Neue Kategorie",color:"#64748b"};r(f=>[...f,d])},p=d=>{r(f=>f.filter(N=>N.id!==d))},b=()=>{n(i),s(!1)};return e.jsx(H,{open:t,onOpenChange:s,children:e.jsxs(R,{className:"sm:max-w-[500px] glass-card",children:[e.jsx(B,{children:e.jsx(Z,{children:"Journal-Kategorien verwalten"})}),e.jsxs("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto pr-4",children:[i.map(d=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(I,{type:"color",value:d.color,onChange:f=>o(d.id,f.target.value),className:"w-10 h-10 p-1 border-0 cursor-pointer",style:{WebkitAppearance:"none",MozAppearance:"none",appearance:"none"}}),e.jsx(Ue,{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-4 w-4 text-white pointer-events-none"})]}),e.jsx(I,{value:d.name,onChange:f=>c(d.id,f.target.value),className:"flex-grow"}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>p(d.id),children:e.jsx(re,{className:"h-4 w-4 text-red-500"})})]},d.id)),e.jsxs(w,{variant:"outline",onClick:m,className:"w-full mt-4",children:[e.jsx(U,{className:"mr-2 h-4 w-4"})," Neue Kategorie"]})]}),e.jsxs(P,{children:[e.jsx(V,{asChild:!0,children:e.jsx(w,{variant:"outline",children:"Abbrechen"})}),e.jsxs(w,{onClick:b,children:[e.jsx($e,{className:"mr-2 h-4 w-4"})," Speichern"]})]})]})})},jt=({open:t,onOpenChange:s,entry:a,getCategory:n,getCoacheeName:i})=>{if(!a)return null;const r=n(a.categoryId),c=i(a.coacheeId);return e.jsx(H,{open:t,onOpenChange:s,children:e.jsxs(R,{className:"sm:max-w-[800px] glass-card",children:[e.jsxs(B,{children:[e.jsx(Z,{className:"text-white text-2xl",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2 items-center",children:[e.jsxs("div",{className:"flex items-center text-sm text-slate-400",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),ce(G(a.date),"dd. MMMM yyyy",{locale:oe})]}),r&&e.jsx(J,{style:{backgroundColor:`${r.color}20`,color:r.color,borderColor:`${r.color}30`},children:r.name}),c&&e.jsxs(J,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),c]})]})]}),e.jsx("div",{className:"py-4 max-h-[70vh] overflow-y-auto pr-4",children:e.jsx("p",{className:"text-slate-300 leading-relaxed whitespace-pre-line",children:a.content})}),e.jsx(P,{children:e.jsx(V,{asChild:!0,children:e.jsx(w,{variant:"outline",children:"Schliessen"})})})]})})},Nt=({entry:t,getCategory:s,getCoacheeName:a,onDelete:n,onEdit:i,onOpenDetail:r})=>{const c=s(t.categoryId),o=a(t.coacheeId);return e.jsxs($,{className:"glass-card hover:bg-slate-800/50 transition-colors",children:[e.jsxs(be,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.isShared&&e.jsx("div",{className:"flex-shrink-0",title:"Vom Coachee geteilt",children:e.jsx(ne,{className:"h-5 w-5 text-primary"})}),e.jsx(Se,{className:"text-white text-xl",children:t.title||"Journaleintrag"})]}),e.jsxs("div",{className:"flex items-center text-sm text-slate-400 flex-shrink-0",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),ce(G(t.date),"dd. MMMM yyyy",{locale:oe})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2 items-center",children:[c&&e.jsx(J,{style:{backgroundColor:`${c.color}20`,color:c.color,borderColor:`${c.color}30`},children:c.name}),o&&!t.isShared&&e.jsxs(J,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),o]})]})]}),e.jsx(L,{onClick:()=>r(t),className:"cursor-pointer",children:e.jsx("p",{className:"text-slate-300 leading-relaxed whitespace-pre-line line-clamp-3",children:t.content})}),e.jsxs(ke,{className:"flex justify-end gap-2",children:[e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>i(t),disabled:t.isShared,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"})," Bearbeiten"]}),e.jsxs(Le,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(w,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600",disabled:t.isShared,children:[e.jsx(re,{className:"h-4 w-4 mr-2"})," Löschen"]})}),e.jsxs(We,{className:"glass-card",children:[e.jsxs(Ye,{children:[e.jsx(Ke,{children:"Eintrag wirklich löschen?"}),e.jsxs(He,{children:['Diese Aktion kann nicht rückgängig gemacht werden. Dadurch wird der Journal-Eintrag "',t.title,'" dauerhaft entfernt.']})]}),e.jsxs(Re,{children:[e.jsx(Be,{children:"Abbrechen"}),e.jsx(Ze,{onClick:()=>n(t.id,t.isShared),className:"bg-red-500 hover:bg-red-600",children:"Löschen"})]})]})]})]})]})};function $t(){const{state:t,actions:s}=Te(),{journalEntries:a,coachees:n,settings:i}=t,{setJournalEntries:r,updateJournalCategories:c}=s,{journalCategories:o}=i,[m,p]=h.useState(!1),[b,d]=h.useState(null),[f,N]=h.useState(!1),[g,S]=h.useState(""),[C,x]=h.useState("all"),[me,q]=h.useState(!1),[ue,xe]=h.useState(null),{toast:D}=Ee(),Q=()=>{d(null),p(!0)},ge=l=>{if(l.isShared){D({variant:"destructive",title:"Bearbeiten nicht möglich",description:"Von Coachees geteilte Einträge können nicht bearbeitet werden."});return}d(l),p(!0)},pe=l=>{xe(l),q(!0)},fe=h.useCallback(l=>{r(u=>(u||[]).findIndex(j=>j.id===l.id)>-1?(D({title:"Eintrag aktualisiert",description:"Dein Journal-Eintrag wurde erfolgreich aktualisiert.",className:"bg-green-600 text-white"}),u.map(j=>j.id===l.id?l:j).sort((j,y)=>new Date(y.date)-new Date(j.date))):(D({title:"Eintrag gespeichert",description:"Dein neuer Journal-Eintrag wurde hinzugefügt.",className:"bg-green-600 text-white"}),[l,...u||[]].sort((j,y)=>new Date(y.date)-new Date(j.date))))},[r,D]),je=h.useCallback((l,u)=>{if(u){D({variant:"destructive",title:"Löschen nicht möglich",description:"Geteilte Einträge können nur vom Coachee gelöscht werden."});return}r(k=>k.filter(j=>j.id!==l)),D({title:"Eintrag gelöscht",description:"Der Journal-Eintrag wurde erfolgreich entfernt.",className:"bg-red-600 text-white"})},[r,D]),Ne=h.useCallback(l=>{c(l),D({title:"Kategorien aktualisiert",description:"Deine Journal-Kategorien wurden gespeichert.",className:"bg-green-600 text-white"})},[c,D]),M=h.useCallback(l=>(o||[]).find(u=>u.id===l),[o]),X=h.useCallback(l=>{const u=(n||[]).find(k=>k.id===l);return u?`${u.firstName} ${u.lastName}`:null},[n]),ee=h.useMemo(()=>(a||[]).filter(l=>{const u=G(l.date);if(!(C==="all"||C==="today"&&Pe(u)||C==="week"&&Xe(u,{weekStartsOn:1})||C==="month"&&Qe(u)||C==="year"&&et(u)))return!1;const j=g.toLowerCase();if(!j)return!0;const y=l.title&&l.title.toLowerCase().includes(j),we=l.content.toLowerCase().includes(j),te=l.categoryId?M(l.categoryId):null,Ce=te?te.name.toLowerCase().includes(j):!1,A=l.coacheeId?n.find(ve=>ve.id===l.coacheeId):null,De=A?`${A.firstName} ${A.lastName}`.toLowerCase().includes(j):!1;return y||we||Ce||De}).sort((l,u)=>new Date(u.date)-new Date(l.date)),[a,g,C,n,o,M]);return e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{children:[e.jsx("title",{children:"Journal - Coachingspace"}),e.jsx("meta",{name:"description",content:"Reflektiere deine Coaching-Praxis mit persönlichen Journal-Einträgen und Erkenntnissen."})]}),e.jsx(pt,{open:m,onOpenChange:p,onSave:fe,coachees:n,categories:o||[],initialEntry:b}),e.jsx(ft,{open:f,onOpenChange:N,categories:o||[],updateCategories:Ne}),e.jsx(jt,{open:me,onOpenChange:q,entry:ue,getCategory:M,getCoacheeName:X}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Journal"}),e.jsx("p",{className:"text-slate-400",children:"Reflektiere deine Coaching-Praxis und sieh geteilte Einträge."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{onClick:()=>N(!0),variant:"outline",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Kategorien"]}),e.jsxs(w,{onClick:Q,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Neuer Eintrag"]})]})]}),e.jsx($,{className:"glass-card",children:e.jsx(L,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx(I,{placeholder:"Einträge durchsuchen...",value:g,onChange:l=>S(l.target.value),className:"pl-10"})]}),e.jsxs(z,{value:C,onValueChange:x,children:[e.jsxs(W,{className:"w-full sm:w-[180px]",children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),e.jsx(Y,{placeholder:"Zeitfilter"})]}),e.jsxs(K,{children:[e.jsx(v,{value:"all",children:"Alle Einträge"}),e.jsx(v,{value:"today",children:"Heute"}),e.jsx(v,{value:"week",children:"Diese Woche"}),e.jsx(v,{value:"month",children:"Dieser Monat"}),e.jsx(v,{value:"year",children:"Dieses Jahr"})]})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(ne,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:"Einträge, die von Coachees mit dir geteilt wurden, sind mit diesem Icon markiert und können nicht bearbeitet oder gelöscht werden."})]}),e.jsx("div",{className:"space-y-6",children:ee.map((l,u)=>e.jsx(Je.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:u*.05},children:e.jsx(Nt,{entry:l,getCategory:M,getCoacheeName:X,onDelete:je,onEdit:ge,onOpenDetail:pe})},l.id))}),ee.length===0&&e.jsx($,{className:"glass-card",children:e.jsxs(L,{className:"p-12 text-center",children:[e.jsx(Ae,{className:"mx-auto h-12 w-12 text-slate-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Keine Journal-Einträge gefunden"}),e.jsx("p",{className:"text-slate-400 mb-4",children:g||C!=="all"?"Deine Suche/Filterung ergab keine Treffer.":"Beginne mit deinem ersten Eintrag."}),!g&&C==="all"&&e.jsxs(w,{onClick:Q,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Ersten Eintrag erstellen"]})]})})]})]})}export{$t as default};
